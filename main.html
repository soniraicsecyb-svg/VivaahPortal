<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VivaahPortal Homepage</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Inter font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <style>
        /* Custom styles for a polished look */
        html {
            scroll-behavior: smooth; /* Smooth scrolling implementation */
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f3f0; /* Light, elegant background */
        }
        .sidebar {
            width: 280px;
            /* Fixed position on the left */
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            background-color: #ffffff; /* White sidebar */
            z-index: 10;
        }
        .main-content {
            /* Offset the main content area by the sidebar width */
            margin-left: 280px;
            min-height: 100vh;
            padding: 0; /* Remove default body padding */
        }
        .tab-button.active {
            border-bottom: 3px solid #f653a6;
            color: #f653a6;
            font-weight: 600;
        }
        .input-field:focus {
            border-color: #f653a6;
            box-shadow: 0 0 0 1px #f653a6;
        }
        .btn-primary {
            transition: all 0.2s;
        }
        .btn-primary:hover {
            box-shadow: 0 4px 15px rgba(246, 83, 166, 0.4);
            transform: translateY(-1px);
        }
    </style>
</head>
<body class="flex">

    <!-- Sidebar Navigation (Fixed Left) -->
    <aside class="sidebar border-r border-gray-100 p-6 flex flex-col">
        <!-- Logo -->
        <header class="pb-6 border-b border-gray-100">
            <h1 class="text-3xl font-extrabold text-[#f653a6]">VivaahPortal</h1>
            <p class="text-sm text-gray-500 mt-1">Marketplace</p>
        </header>

        <!-- User Status -->
        <div id="user-status-area" class="py-6 border-b border-gray-100">
            <!-- User Name / Status -->
            <p id="user-display-name" class="text-lg font-semibold text-gray-800">Hello, Guest</p>
            <p id="auth-action-link" class="text-sm text-pink-600 cursor-pointer hover:underline mt-1" onclick="openLoginModal()">Log In / Sign Up</p>
        </div>

        <!-- Main Menu -->
        <nav class="flex-grow pt-8">
            <h3 class="text-xs font-semibold uppercase text-gray-400 mb-4">Browse Categories</h3>
            <ul class="space-y-3">
                <li>
                    <a href="#wedding-halls" class="block text-gray-700 hover:text-[#f653a6] transition duration-150 p-2 rounded-lg hover:bg-pink-50">
                        1) Wedding Halls
                    </a>
                </li>
                <li>
                    <a href="#decoration-list" class="block text-gray-700 hover:text-[#f653a6] transition duration-150 p-2 rounded-lg hover:bg-pink-50">
                        2) Decoration List
                    </a>
                </li>
                <li>
                    <a href="#photographer-videographer" class="block text-gray-700 hover:text-[#f653a6] transition duration-150 p-2 rounded-lg hover:bg-pink-50">
                        3) Photographer/Videographer
                    </a>
                </li>
            </ul>
        </nav>
        
        <!-- User ID Display (only shown for authenticated users, mainly for debugging) -->
        <div id="user-id-display-sidebar" class="text-xs text-gray-400 mt-auto pt-4 border-t border-gray-100 hidden">
            User ID: <span id="current-user-id" class="break-words"></span>
        </div>
    </aside>

    <!-- Main Content Area -->
    <main class="main-content">
        <!-- Hero Section -->
        <section id="hero" class="h-[60vh] bg-cover bg-center flex items-center justify-center p-10 shadow-lg" 
                 style="background-image: url('https://placehold.co/1200x600/f653a6/ffffff?text=Find+Your+Dream+Venue');">
            <div class="text-center bg-white/80 p-8 rounded-xl backdrop-blur-sm shadow-2xl">
                <h2 class="text-5xl font-extrabold text-[#f653a6] mb-3">Your Perfect Wedding, Simplified.</h2>
                <p class="text-xl text-gray-700">Explore trusted vendors for halls, decor, and photography.</p>
                <a href="#wedding-halls" class="inline-block mt-6 px-8 py-3 bg-pink-600 text-white font-semibold rounded-lg shadow-xl hover:bg-pink-700 transition duration-300">
                    Start Planning Now
                </a>
            </div>
        </section>

        <!-- Wedding Halls Section -->
        <section id="wedding-halls" class="py-16 px-10 bg-white border-b border-gray-100">
            <h3 class="text-4xl font-bold text-gray-800 mb-8 border-b-2 border-[#f653a6] inline-block pb-1">Wedding Halls</h3>
            <div class="grid md:grid-cols-3 gap-8">
                <!-- Placeholder Card -->
                <div class="bg-gray-50 rounded-lg shadow-md overflow-hidden">
                    <img src="https://placehold.co/600x400/ccc/333?text=Grand+Ballroom" alt="Venue Placeholder" class="w-full h-48 object-cover">
                    <div class="p-4">
                        <h4 class="text-xl font-semibold text-[#f653a6]">The Imperial Gardens</h4>
                        <p class="text-sm text-gray-600 mt-1">Capacity: 500 | Location: City Center</p>
                        <button class="mt-3 px-4 py-2 text-sm bg-pink-500 text-white rounded-lg hover:bg-pink-600">View Details</button>
                    </div>
                </div>
                <!-- Placeholder Card -->
                <div class="bg-gray-50 rounded-lg shadow-md overflow-hidden">
                    <img src="https://placehold.co/600x400/ccc/333?text=Rustic+Barn" alt="Venue Placeholder" class="w-full h-48 object-cover">
                    <div class="p-4">
                        <h4 class="text-xl font-semibold text-[#f653a6]">Rustic Meadows Barn</h4>
                        <p class="text-sm text-gray-600 mt-1">Capacity: 150 | Location: Countryside</p>
                        <button class="mt-3 px-4 py-2 text-sm bg-pink-500 text-white rounded-lg hover:bg-pink-600">View Details</button>
                    </div>
                </div>
                <!-- Placeholder Card -->
                <div class="bg-gray-50 rounded-lg shadow-md overflow-hidden">
                    <img src="https://placehold.co/600x400/ccc/333?text=Beachfront+Resort" alt="Venue Placeholder" class="w-full h-48 object-cover">
                    <div class="p-4">
                        <h4 class="text-xl font-semibold text-[#f653a6]">Sunset Beach Resort</h4>
                        <p class="text-sm text-gray-600 mt-1">Capacity: 300 | Location: Coastal</p>
                        <button class="mt-3 px-4 py-2 text-sm bg-pink-500 text-white rounded-lg hover:bg-pink-600">View Details</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Decoration List Section -->
        <section id="decoration-list" class="py-16 px-10 bg-[#f7f3f0] border-b border-gray-100">
            <h3 class="text-4xl font-bold text-gray-800 mb-8 border-b-2 border-[#f653a6] inline-block pb-1">Decoration List</h3>
            <div class="grid md:grid-cols-3 gap-8">
                <!-- Decor Card -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h4 class="text-xl font-semibold text-[#f653a6]">Floral Design Co.</h4>
                    <p class="text-sm text-gray-600 mt-1">Specializes in seasonal and exotic florals.</p>
                    <button class="mt-3 px-4 py-2 text-sm bg-pink-500 text-white rounded-lg hover:bg-pink-600">Browse Packages</button>
                </div>
                 <!-- Decor Card -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h4 class="text-xl font-semibold text-[#f653a6]">Lighting Experts</h4>
                    <p class="text-sm text-gray-600 mt-1">Ambient lighting and custom light projections.</p>
                    <button class="mt-3 px-4 py-2 text-sm bg-pink-500 text-white rounded-lg hover:bg-pink-600">Browse Packages</button>
                </div>
                 <!-- Decor Card -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h4 class="text-xl font-semibold text-[#f653a6]">Draping & Linens</h4>
                    <p class="text-sm text-gray-600 mt-1">Elegant fabrics and mandap designs.</p>
                    <button class="mt-3 px-4 py-2 text-sm bg-pink-500 text-white rounded-lg hover:bg-pink-600">Browse Packages</button>
                </div>
            </div>
        </section>

        <!-- Photographer/Videographer Section -->
        <section id="photographer-videographer" class="py-16 px-10 bg-white">
            <h3 class="text-4xl font-bold text-gray-800 mb-8 border-b-2 border-[#f653a6] inline-block pb-1">Photographer/Videographer</h3>
            <div class="grid md:grid-cols-2 gap-8">
                <!-- Vendor Card -->
                <div class="bg-gray-50 rounded-lg shadow-md p-6 flex items-center space-x-4">
                    <img src="https://placehold.co/100x100/f653a6/ffffff?text=P" alt="Vendor Placeholder" class="rounded-full w-20 h-20 object-cover">
                    <div>
                        <h4 class="text-xl font-semibold text-[#f653a6]">Lens & Love Studios</h4>
                        <p class="text-sm text-gray-600 mt-1">Candid photography and cinematic wedding films.</p>
                        <button class="mt-3 px-4 py-2 text-sm bg-pink-500 text-white rounded-lg hover:bg-pink-600">View Portfolio</button>
                    </div>
                </div>
                <!-- Vendor Card -->
                <div class="bg-gray-50 rounded-lg shadow-md p-6 flex items-center space-x-4">
                    <img src="https://placehold.co/100x100/f653a6/ffffff?text=V" alt="Vendor Placeholder" class="rounded-full w-20 h-20 object-cover">
                    <div>
                        <h4 class="text-xl font-semibold text-[#f653a6]">Vivid Vision Films</h4>
                        <p class="text-sm text-gray-600 mt-1">Drone footage and artistic highlight reels.</p>
                        <button class="mt-3 px-4 py-2 text-sm bg-pink-500 text-white rounded-lg hover:bg-pink-600">View Portfolio</button>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Footer -->
        <footer class="text-center py-6 bg-gray-100 text-gray-500 text-sm">
            © 2025 VivaahPortal. All rights reserved.
        </footer>
    </main>
    
    <!-- Login Modal (Hidden by default, replacing the auth-container placement) -->
    <div id="login-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
         <div id="auth-container" class="bg-white shadow-2xl rounded-xl w-full max-w-md overflow-hidden transition-all duration-300">

            <!-- Logo/Header (Modal Content) -->
            <header class="p-6 text-center border-b border-gray-100">
                <h1 class="text-3xl font-extrabold text-[#f653a6]">VivaahPortal Login</h1>
                <p class="text-sm text-gray-500 mt-1">Access your planner account.</p>
                <button onclick="closeLoginModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">&times;</button>
            </header>

            <!-- Auth Tabs -->
            <div class="flex border-b border-gray-100">
                <button id="login-tab" class="tab-button flex-1 py-3 text-center text-gray-600 active" onclick="showTab('login')">
                    Login
                </button>
                <button id="signup-tab" class="tab-button flex-1 py-3 text-center text-gray-600" onclick="showTab('signup')">
                    Sign Up
                </button>
            </div>

            <!-- Auth Forms -->
            <div class="p-8">

                <!-- Shared Email and Password fields -->
                <div class="space-y-4">
                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                        <input type="email" id="email" class="input-field w-full p-3 border border-gray-300 rounded-lg outline-none" placeholder="you@example.com">
                    </div>
                    <div>
                        <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        <input type="password" id="password" class="input-field w-full p-3 border border-gray-300 rounded-lg outline-none" placeholder="••••••••">
                    </div>
                </div>

                <!-- Login View -->
                <div id="login-view" class="mt-6">
                    <button onclick="handleLogin()" class="btn-primary w-full p-3 rounded-lg text-white bg-[#f653a6] text-lg font-semibold shadow-lg shadow-[#f653a6]/30">
                        Log In
                    </button>
                    <p class="text-xs text-gray-500 text-center mt-4">By logging in, you agree to our terms.</p>
                </div>

                <!-- Signup View (Hidden by default) -->
                <div id="signup-view" class="mt-6 hidden">
                     <!-- Additional Signup Fields could go here if needed -->
                     <button onclick="handleSignup()" class="btn-primary w-full p-3 rounded-lg text-white bg-pink-500 text-lg font-semibold shadow-lg shadow-pink-500/30">
                        Create Account
                    </button>
                    <p class="text-xs text-gray-500 text-center mt-4">New accounts will be created instantly.</p>
                </div>

                <!-- Message Box -->
                <div id="message-box" class="mt-4 p-3 rounded-lg text-center font-medium hidden"></div>
            </div>
        </div>
    </div>


    <!-- Firebase SDK Imports -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global Firebase variables accessible to the window scope
        window.firebaseApp = null;
        window.auth = null;
        window.db = null;
        window.currentUserId = null;

        // --- Initialization and Utility Functions ---

        /**
         * Basic email format validation.
         * @param {string} email - The email string to validate.
         * @returns {boolean} True if the email looks valid, false otherwise.
         */
        function isValidEmail(email) {
            // Simple regex for email format: local@domain.tld
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(String(email).toLowerCase());
        }

        /**
         * Displays a message in the UI message box.
         * @param {string} message - The message content.
         * @param {boolean} isError - True for error (red), false for success (green/blue).
         */
        function showMessage(message, isError) {
            const box = document.getElementById('message-box');
            box.textContent = message;
            box.className = 'mt-4 p-3 rounded-lg text-center font-medium'; // Reset classes
            if (isError) {
                box.classList.add('bg-red-100', 'text-red-700');
            } else {
                box.classList.add('bg-blue-100', 'text-blue-700');
            }
            box.classList.remove('hidden');
        }

        /**
         * Hides the message box.
         */
        function hideMessage() {
            document.getElementById('message-box').classList.add('hidden');
        }

        /**
         * Opens the Login/Signup Modal.
         */
        window.openLoginModal = () => {
            document.getElementById('login-modal').classList.remove('hidden');
        };

        /**
         * Closes the Login/Signup Modal.
         */
        window.closeLoginModal = () => {
            document.getElementById('login-modal').classList.add('hidden');
            hideMessage();
        };

        /**
         * Updates the user status section in the sidebar.
         * @param {Object|null} user - The Firebase User object or null.
         */
        function updateSidebarUserStatus(user) {
            const displayNameEl = document.getElementById('user-display-name');
            const authActionEl = document.getElementById('auth-action-link');
            const userIdDisplayEl = document.getElementById('user-id-display-sidebar');
            const currentUserIdEl = document.getElementById('current-user-id');

            if (user && user.isAnonymous === false) {
                // Logged in via Email/Password
                displayNameEl.textContent = `Hello, ${user.email || 'User'}!`;
                authActionEl.textContent = 'Logout';
                authActionEl.onclick = window.handleLogout;
                userIdDisplayEl.classList.remove('hidden');
                currentUserIdEl.textContent = user.uid;
            } else if (user && user.isAnonymous === true) {
                 // Logged in anonymously
                displayNameEl.textContent = 'Hello, Guest';
                authActionEl.textContent = 'Log In / Sign Up';
                authActionEl.onclick = window.openLoginModal;
                userIdDisplayEl.classList.add('hidden');
                currentUserIdEl.textContent = '';
            } else {
                // Not authenticated
                displayNameEl.textContent = 'Hello, Guest';
                authActionEl.textContent = 'Log In / Sign Up';
                authActionEl.onclick = window.openLoginModal;
                userIdDisplayEl.classList.add('hidden');
                currentUserIdEl.textContent = '';
            }
            
            // Close the modal if successful login/logout occurs
            if (user && user.isAnonymous === false) {
                 window.closeLoginModal();
            }
        }


        /**
         * Sets up the Firebase application, authentication, and Firestore.
         */
        async function setupFirebase() {
            try {
                // Global variables are provided by the canvas environment
                const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
                const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
                const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

                if (!firebaseConfig) {
                    throw new Error("Firebase configuration is missing.");
                }

                window.firebaseApp = initializeApp(firebaseConfig);
                window.auth = getAuth(window.firebaseApp);
                window.db = getFirestore(window.firebaseApp);

                // PROACTIVE WARNING for the persistent auth/operation-not-allowed error
                console.warn("FIREBASE AUTH WARNING: If you see 'auth/operation-not-allowed' errors, please ensure you have enabled the 'Email/Password' sign-in provider in your Firebase console under Authentication -> Sign-in method.");

                // Initial Authentication Check (sign in first, then listen)
                if (initialAuthToken) {
                    await signInWithCustomToken(window.auth, initialAuthToken);
                    console.log("Signed in with initial custom token.");
                } else {
                    await signInAnonymously(window.auth);
                    console.log("Signed in anonymously.");
                }

                // Listen for authentication state changes and update the sidebar
                onAuthStateChanged(window.auth, (user) => {
                    window.currentUserId = user ? user.uid : null;
                    updateSidebarUserStatus(user);
                    console.log("User state changed. ID:", window.currentUserId);
                });

            } catch (error) {
                console.error("Firebase setup failed:", error);
                showMessage(`Initialization Error: ${error.message}`, true);
            }
        }

        // Run Firebase setup on load
        setupFirebase();

        // --- Auth Handlers ---

        /**
         * Handles user login with email and password.
         */
        window.handleLogin = async () => {
            hideMessage();
            // Trim whitespace from email and password
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value.trim();

            if (!email || !password) {
                showMessage("Please enter both email and password.", true);
                return;
            }

            // CHECK 1: Validate email format before calling Firebase
            if (!isValidEmail(email)) {
                showMessage("The email address format is invalid. Check for typos.", true);
                return;
            }

            try {
                await signInWithEmailAndPassword(window.auth, email, password);
                showMessage("Login successful!", false);
                // onAuthStateChanged listener handles the sidebar update and modal close
            } catch (error) {
                console.error("Login Error:", error);
                let errorMessage = "Login failed. Please check your credentials.";
                
                if (error.code === 'auth/operation-not-allowed') {
                    // Enhanced message focusing on the required action
                    errorMessage = "Authentication provider not enabled. You must enable the **Email/Password** sign-in method in your Firebase console.";
                } else if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') {
                    errorMessage = "Invalid email or password.";
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = "Invalid email format.";
                }
                showMessage(errorMessage, true);
            }
        };

        /**
         * Handles user registration with email and password.
         */
        window.handleSignup = async () => {
            hideMessage();
            // Trim whitespace from email and password
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value.trim();

            if (!email || !password) {
                showMessage("Please enter both email and password.", true);
                return;
            }
            
            // CHECK 1: Validate email format before calling Firebase
            if (!isValidEmail(email)) {
                showMessage("The email address format is invalid. Check for typos.", true);
                return;
            }

            if (password.length < 6) {
                showMessage("Password must be at least 6 characters long.", true);
                return;
            }

            try {
                const userCredential = await createUserWithEmailAndPassword(window.auth, email, password);
                const user = userCredential.user;

                // Optionally save basic user data to Firestore immediately after signup
                const userDocRef = doc(window.db, `artifacts/${window.__app_id}/users/${user.uid}/profile/details`);
                await setDoc(userDocRef, {
                    email: user.email,
                    createdAt: new Date().toISOString(),
                    userRole: 'customer' // Default role
                });

                showMessage("Account created successfully! Welcome.", false);
                // onAuthStateChanged listener handles the sidebar update and modal close
            } catch (error) {
                console.error("Signup Error:", error);
                let errorMessage = "Signup failed. An account with this email might already exist.";

                if (error.code === 'auth/operation-not-allowed') {
                     // Enhanced message focusing on the required action
                    errorMessage = "Authentication provider not enabled. You must enable the **Email/Password** sign-in method in your Firebase console.";
                } else if (error.code === 'auth/email-already-in-use') {
                    errorMessage = "This email is already in use. Try logging in.";
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = "The email address is not valid.";
                } else if (error.code === 'auth/weak-password') {
                    errorMessage = "Password is too weak. Must be 6+ characters.";
                }
                showMessage(errorMessage, true);
            }
        };

        /**
         * Handles user logout.
         */
        window.handleLogout = async () => {
            try {
                await signOut(window.auth);
                showMessage("You have been signed out.", false);
            } catch (error) {
                console.error("Logout Error:", error);
                showMessage("Logout failed.", true);
            }
        };

        // --- UI Logic ---

        /**
         * Toggles between the Login and Signup tabs within the modal.
         * @param {string} tabName - 'login' or 'signup'
         */
        window.showTab = (tabName) => {
            const loginView = document.getElementById('login-view');
            const signupView = document.getElementById('signup-view');
            const loginTab = document.getElementById('login-tab');
            const signupTab = document.getElementById('signup-tab');
            hideMessage();

            if (tabName === 'login') {
                loginView.classList.remove('hidden');
                signupView.classList.add('hidden');
                loginTab.classList.add('active');
                signupTab.classList.remove('active');
            } else if (tabName === 'signup') {
                loginView.classList.add('hidden');
                signupView.classList.remove('hidden');
                loginTab.classList.remove('active');
                signupTab.classList.add('active');
            }
        };
    </script>
</body>
</html>